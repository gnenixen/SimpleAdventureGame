[gd_scene load_steps=22 format=3 uid="uid://dbv05hlngv2re"]

[ext_resource type="Script" path="res://src/system/level.gd" id="1_n7ko7"]
[ext_resource type="Texture2D" uid="uid://cexn6mp4wkbhp" path="res://assets/images/scenes/img_floor_leaves.PNG" id="2_ityg2"]
[ext_resource type="PackedScene" uid="uid://bijoa203rnrn2" path="res://assets/entities/interactables/ent_mailbox.tscn" id="3_4iueu"]
[ext_resource type="PackedScene" uid="uid://bfj2mwpvofvpj" path="res://assets/entities/items/ent_key.tscn" id="3_ne24i"]
[ext_resource type="PackedScene" uid="uid://sa7e7lp2mlfd" path="res://assets/entities/ent_trigger_scene_change.tscn" id="4_g3ges"]
[ext_resource type="PackedScene" uid="uid://bgm1pf2u3bwny" path="res://assets/entities/interactables/ent_bush.tscn" id="4_qk8tv"]
[ext_resource type="Texture2D" uid="uid://dhnn2s3qhv4qn" path="res://assets/images/scenes/img_house.PNG" id="5_rwrxb"]
[ext_resource type="Script" path="res://src/system/player_spawn_position.gd" id="5_wpplf"]
[ext_resource type="Script" path="res://src/entities/ent_door_lock.gd" id="5_x7wpw"]
[ext_resource type="Texture2D" uid="uid://crt23hs7a4x2r" path="res://assets/images/scenes/img_door.PNG" id="8_g8r5u"]

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_qfrqg"]
normal = Vector2(0, 1)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_of33u"]
normal = Vector2(-1, 0)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_g54bg"]
normal = Vector2(1, 0)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_yttf5"]

[sub_resource type="NavigationPolygon" id="NavigationPolygon_c5csv"]
vertices = PackedVector2Array(266, 410, 1142, 638, 10, 638, 230, 410, 10, 10, 230, 366, 1142, 10, 266, 366)
polygons = Array[PackedInt32Array]([PackedInt32Array(0, 1, 2, 3), PackedInt32Array(3, 2, 4, 5), PackedInt32Array(5, 4, 6, 7), PackedInt32Array(7, 6, 1, 0)])
outlines = Array[PackedVector2Array]([PackedVector2Array(1152, 0, 0, 0, 0, 648, 1152, 648)])
parsed_geometry_type = 1
source_geometry_mode = 1
source_geometry_group_name = &"navigation_blocker"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_mwpsu"]
size = Vector2(80, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_mxe2n"]
size = Vector2(80, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_g4xoh"]
size = Vector2(80, 32)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_5fw4l"]
size = Vector2(160, 88)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_lo5fb"]
size = Vector2(40, 16)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_hhmmn"]
size = Vector2(40, 16)

[node name="scn_street" type="Node2D" node_paths=PackedStringArray("player_spawn_position", "random_teleportation_navmesh", "pickables_root_node")]
process_mode = 1
z_as_relative = false
y_sort_enabled = true
script = ExtResource("1_n7ko7")
player_spawn_position = NodePath("PlayerSpawnPosition")
random_teleportation_navmesh = NodePath("LevelData/RandomTeleportationNavMesh")
pickables_root_node = NodePath("Entities/Pickables")

[node name="LevelData" type="Node2D" parent="."]

[node name="Floor" type="Sprite2D" parent="LevelData"]
modulate = Color(0.435294, 0.435294, 0.435294, 1)
texture_repeat = 2
position = Vector2(576, 324)
scale = Vector2(0.5625, 0.316406)
texture = ExtResource("2_ityg2")

[node name="LevelBounds" type="StaticBody2D" parent="LevelData"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="LevelData/LevelBounds" node_paths=PackedStringArray("random_teleportation_navmesh")]
position = Vector2(576, 0)
shape = SubResource("WorldBoundaryShape2D_qfrqg")
script = ExtResource("1_n7ko7")
random_teleportation_navmesh = NodePath("../../RandomTeleportationNavMesh")

[node name="CollisionShape2D3" type="CollisionShape2D" parent="LevelData/LevelBounds"]
position = Vector2(1152, 320)
shape = SubResource("WorldBoundaryShape2D_of33u")

[node name="CollisionShape2D4" type="CollisionShape2D" parent="LevelData/LevelBounds"]
position = Vector2(0, 320)
shape = SubResource("WorldBoundaryShape2D_g54bg")

[node name="CollisionShape2D2" type="CollisionShape2D" parent="LevelData/LevelBounds"]
position = Vector2(576, 648)
shape = SubResource("WorldBoundaryShape2D_yttf5")

[node name="RandomTeleportationNavMesh" type="NavigationRegion2D" parent="LevelData"]
editor_description = "Used by teleportation potion to pick random position where player teleportation is safe"
visible = false
navigation_polygon = SubResource("NavigationPolygon_c5csv")

[node name="Entities" type="Node2D" parent="."]
z_as_relative = false
y_sort_enabled = true

[node name="Interactables" type="Node2D" parent="Entities"]
z_as_relative = false
y_sort_enabled = true

[node name="ent_mailbox" parent="Entities/Interactables" instance=ExtResource("3_4iueu")]
position = Vector2(512, 248)
display_message = "Почтовый ящик полный писем"

[node name="ent_mailbox3" parent="Entities/Interactables" instance=ExtResource("3_4iueu")]
position = Vector2(888, 312)
display_message = "Потрёпаный жизнью почтовый ящик"

[node name="ent_mailbox2" parent="Entities/Interactables" instance=ExtResource("3_4iueu")]
position = Vector2(128, 328)

[node name="ent_bush" parent="Entities/Interactables" instance=ExtResource("4_qk8tv")]
position = Vector2(328, 552)

[node name="ent_bush2" parent="Entities/Interactables" instance=ExtResource("4_qk8tv")]
position = Vector2(760, 560)
display_message = "Ещё более красивый, ухоженный кустик"

[node name="Pickables" type="Node2D" parent="Entities"]

[node name="ent_key" parent="Entities/Pickables" instance=ExtResource("3_ne24i")]
position = Vector2(352, 416)

[node name="ent_key2" parent="Entities/Pickables" instance=ExtResource("3_ne24i")]
position = Vector2(416, 416)

[node name="ent_key3" parent="Entities/Pickables" instance=ExtResource("3_ne24i")]
position = Vector2(488, 416)

[node name="ent_key4" parent="Entities/Pickables" instance=ExtResource("3_ne24i")]
position = Vector2(552, 416)

[node name="ent_key5" parent="Entities/Pickables" instance=ExtResource("3_ne24i")]
position = Vector2(616, 416)

[node name="ent_key6" parent="Entities/Pickables" instance=ExtResource("3_ne24i")]
position = Vector2(680, 416)

[node name="House_1" type="Node2D" parent="Entities"]
position = Vector2(192, 200)

[node name="Sprite2D" type="Sprite2D" parent="Entities/House_1"]
y_sort_enabled = true
position = Vector2(-4, 38)
scale = Vector2(0.1, 0.1)
texture = ExtResource("5_rwrxb")
offset = Vector2(2.08165e-12, -400)

[node name="HouseEnter_1" type="Node2D" parent="Entities/House_1"]
position = Vector2(0, 56)
metadata/_edit_group_ = true

[node name="ent_trigger_scene_change" parent="Entities/House_1/HouseEnter_1" instance=ExtResource("4_g3ges")]
scene_name = "house_1"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_1/HouseEnter_1/ent_trigger_scene_change"]
shape = SubResource("RectangleShape2D_mwpsu")

[node name="ent_door_lock" type="StaticBody2D" parent="Entities/House_1/HouseEnter_1"]
script = ExtResource("5_x7wpw")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_1/HouseEnter_1/ent_door_lock"]
shape = SubResource("RectangleShape2D_mxe2n")

[node name="UnlockArea" type="Area2D" parent="Entities/House_1/HouseEnter_1/ent_door_lock"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_1/HouseEnter_1/ent_door_lock/UnlockArea"]
position = Vector2(0, 8)
shape = SubResource("RectangleShape2D_g4xoh")

[node name="VisualDoor" type="Sprite2D" parent="Entities/House_1/HouseEnter_1/ent_door_lock"]
z_as_relative = false
y_sort_enabled = true
position = Vector2(-1, 0)
scale = Vector2(0.07, 0.07)
texture = ExtResource("8_g8r5u")
offset = Vector2(2.08165e-12, -200)

[node name="house_1_exit" type="Marker2D" parent="Entities/House_1/HouseEnter_1"]
position = Vector2(0, 48)
script = ExtResource("5_wpplf")
spawn_position_name = "house_1_exit"

[node name="HouseCollision_1" type="StaticBody2D" parent="Entities/House_1"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_1/HouseCollision_1"]
position = Vector2(0, 4)
shape = SubResource("RectangleShape2D_5fw4l")

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Entities/House_1/HouseCollision_1"]
position = Vector2(-60, 56)
shape = SubResource("RectangleShape2D_lo5fb")

[node name="CollisionShape2D3" type="CollisionShape2D" parent="Entities/House_1/HouseCollision_1"]
position = Vector2(60, 56)
shape = SubResource("RectangleShape2D_hhmmn")

[node name="House_2" type="Node2D" parent="Entities"]
position = Vector2(576, 128)
metadata/_edit_group_ = true

[node name="Sprite2D" type="Sprite2D" parent="Entities/House_2"]
y_sort_enabled = true
position = Vector2(-4, 38)
scale = Vector2(0.1, 0.1)
texture = ExtResource("5_rwrxb")
offset = Vector2(2.08165e-12, -400)

[node name="HouseCollision_2" type="StaticBody2D" parent="Entities/House_2"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_2/HouseCollision_2"]
position = Vector2(0, 4)
shape = SubResource("RectangleShape2D_5fw4l")

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Entities/House_2/HouseCollision_2"]
position = Vector2(-60, 56)
shape = SubResource("RectangleShape2D_lo5fb")

[node name="CollisionShape2D3" type="CollisionShape2D" parent="Entities/House_2/HouseCollision_2"]
position = Vector2(60, 56)
shape = SubResource("RectangleShape2D_hhmmn")

[node name="HouseEnter_2" type="Node2D" parent="Entities/House_2"]
position = Vector2(0, 56)
metadata/_edit_group_ = true

[node name="ent_trigger_scene_change" parent="Entities/House_2/HouseEnter_2" instance=ExtResource("4_g3ges")]
scene_name = "house_2"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_2/HouseEnter_2/ent_trigger_scene_change"]
shape = SubResource("RectangleShape2D_mwpsu")

[node name="ent_door_lock" type="StaticBody2D" parent="Entities/House_2/HouseEnter_2"]
script = ExtResource("5_x7wpw")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_2/HouseEnter_2/ent_door_lock"]
shape = SubResource("RectangleShape2D_mxe2n")

[node name="UnlockArea" type="Area2D" parent="Entities/House_2/HouseEnter_2/ent_door_lock"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_2/HouseEnter_2/ent_door_lock/UnlockArea"]
position = Vector2(0, 8)
shape = SubResource("RectangleShape2D_g4xoh")

[node name="VisualDoor" type="Sprite2D" parent="Entities/House_2/HouseEnter_2/ent_door_lock"]
z_as_relative = false
y_sort_enabled = true
position = Vector2(-1, 0)
scale = Vector2(0.07, 0.07)
texture = ExtResource("8_g8r5u")
offset = Vector2(2.08165e-12, -200)

[node name="house_2_exit" type="Marker2D" parent="Entities/House_2/HouseEnter_2"]
position = Vector2(0, 48)
script = ExtResource("5_wpplf")
spawn_position_name = "house_2_exit"

[node name="House_3" type="Node2D" parent="Entities"]
position = Vector2(960, 200)
metadata/_edit_group_ = true

[node name="Sprite2D" type="Sprite2D" parent="Entities/House_3"]
y_sort_enabled = true
position = Vector2(-4, 38)
scale = Vector2(0.1, 0.1)
texture = ExtResource("5_rwrxb")
offset = Vector2(2.08165e-12, -400)

[node name="HouseCollision_2" type="StaticBody2D" parent="Entities/House_3"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_3/HouseCollision_2"]
position = Vector2(0, 4)
shape = SubResource("RectangleShape2D_5fw4l")

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Entities/House_3/HouseCollision_2"]
position = Vector2(-60, 56)
shape = SubResource("RectangleShape2D_lo5fb")

[node name="CollisionShape2D3" type="CollisionShape2D" parent="Entities/House_3/HouseCollision_2"]
position = Vector2(60, 56)
shape = SubResource("RectangleShape2D_hhmmn")

[node name="HouseEnter_3" type="Node2D" parent="Entities/House_3"]
position = Vector2(0, 56)
metadata/_edit_group_ = true

[node name="ent_trigger_scene_change" parent="Entities/House_3/HouseEnter_3" instance=ExtResource("4_g3ges")]
scene_name = "house_3"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_3/HouseEnter_3/ent_trigger_scene_change"]
shape = SubResource("RectangleShape2D_mwpsu")

[node name="ent_door_lock" type="StaticBody2D" parent="Entities/House_3/HouseEnter_3"]
script = ExtResource("5_x7wpw")
is_locked = false

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_3/HouseEnter_3/ent_door_lock"]
shape = SubResource("RectangleShape2D_mxe2n")

[node name="UnlockArea" type="Area2D" parent="Entities/House_3/HouseEnter_3/ent_door_lock"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Entities/House_3/HouseEnter_3/ent_door_lock/UnlockArea"]
position = Vector2(0, 8)
shape = SubResource("RectangleShape2D_g4xoh")

[node name="VisualDoor" type="Sprite2D" parent="Entities/House_3/HouseEnter_3/ent_door_lock"]
z_as_relative = false
y_sort_enabled = true
position = Vector2(-1, 0)
scale = Vector2(0.07, 0.07)
texture = ExtResource("8_g8r5u")
offset = Vector2(2.08165e-12, -200)

[node name="house_3_exit" type="Marker2D" parent="Entities/House_3/HouseEnter_3"]
position = Vector2(0, 48)
script = ExtResource("5_wpplf")
spawn_position_name = "house_3_exit"

[node name="PlayerSpawnPosition" type="Marker2D" parent="."]
position = Vector2(576, 576)
script = ExtResource("5_wpplf")

[connection signal="body_entered" from="Entities/House_1/HouseEnter_1/ent_door_lock/UnlockArea" to="Entities/House_1/HouseEnter_1/ent_door_lock" method="_on_unlock_area_body_entered"]
[connection signal="body_entered" from="Entities/House_2/HouseEnter_2/ent_door_lock/UnlockArea" to="Entities/House_2/HouseEnter_2/ent_door_lock" method="_on_unlock_area_body_entered"]
[connection signal="body_entered" from="Entities/House_3/HouseEnter_3/ent_door_lock/UnlockArea" to="Entities/House_3/HouseEnter_3/ent_door_lock" method="_on_unlock_area_body_entered"]
